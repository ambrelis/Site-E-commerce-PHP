{% extends 'base.html.twig' %}

{% block title %}Produits{% endblock %}

{% block body %}
    <h1>Produits</h1>
    <table class="table">
            <tbody class="detailProduit">
            {% if is_granted('ROLE_ADMIN') %}
            <tr>
                <th>Id</th>
                <td>{{ produit.id }}</td>

            </tr>
            <tr>
                <th>Nom</th>
                <td>{{ produit.nom }}</td>
            </tr>
            <tr>
                <th>Type</th>
                <td>{{ produit.type }}</td>
            </tr>
            <tr>
                <th>Prix</th>
                <td>{{ produit.prix }}</td>
            </tr>
            <tr>
                <th>Description</th>
                <td>{{ produit.description }}</td>
            </tr>
            <tr>
                <th>Photo</th>
                <td><img src="{{ produit.photo }}"></td>
            </tr>
            {% else %}
                <tr>
                    <td><img src="{{ produit.photo }}" alt="photo du produit"></td>
                </tr>
                <tr>
                    <td>{{ produit.nom }}</td>
                </tr>
                <tr>
                    <td>{{ produit.prix }}</td>
                </tr>
                <tr>
                    <td>{{ produit.description }}</td>
                </tr>
            {% endif %}

        </tbody>


    </table>

    <form id="add-to-cart-form" action="{{ path('app_panier_add_produit', {'id': produit.id}) }}" method="post" >
        <label for="quantity">Quantité :</label>
        <input type="number" id="quantity" name="quantity" value="1" min="1">
        <button type="submit" class="btn btn-primary">Ajouter au panier</button>
    </form>
    <p id="prixTotal">Prix total : {{ produit.prix }} €</p>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Récupérer les éléments du formulaire et le prix initial
            const quantityInput = document.getElementById('quantity');
            const prixTotalElement = document.getElementById('prixTotal');
            const prixInitial = parseFloat("{{ produit.prix }}");

            // Fonction pour mettre à jour le prix total
            function updateTotalPrice() {
                const quantity = parseInt(quantityInput.value);
                const prixTotal = quantity * prixInitial;
                prixTotalElement.textContent = `Prix total : ${prixTotal.toFixed(2)} €`;
            }

            // Mettre à jour le prix total lorsque la quantité change
            quantityInput.addEventListener('input', updateTotalPrice);

            // Mettre à jour le prix total lors du chargement de la page
            updateTotalPrice();
        });
    </script>


<button class="btn"><a href="{{ path('app_produits_index') }}">Retour à la boutique</a></button>

    {% if is_granted('ROLE_ADMIN') %}
        <button class="btn"><a href="{{ path('app_produits_edit', {'id': produit.id}) }}">edit</a></button>
    {% endif %}


    {{ include('produits/_delete_form.html.twig') }}

    {% if comments is not empty %}
        {% for comment in comments %}
            <article class="">
                <div>
                    <p class="">{{ comment.titre }}</p>
                    <p>{{ comment.content }}</p>
                    <p>{{ comment.user.email }}</p>


                </div>
                {% if is_granted('ROLE_ADMIN') or app.user == comment.user %}
                    <p>
                        <a href="{{ path('app_comment_show', {'id': comment.id}) }}" class="btn btn-primary">show</a>
                        <a href="{{ path('app_comment_edit', {'id': comment.id}) }}" class="btn btn-primary">edit</a>
                    </p>
                {% endif %}
            </article>
        {% endfor %}
    {% else %}
        <p class="">Il n'y a pas encore de commentaire pour ce produit</p>
    {% endif %}


        {% if is_granted('ROLE_ADMIN') %} {# Vérifie si l'utilisateur est authentifié #}
        <button class="btn"><a href="{{ path('app_comment_new', {'id': produit.id}) }}">Ajouter un avis</a></button>
            <a href="{{ path('app_comment_index') }}" class="btn">voir la liste des avis </a>
        {% else %}
            {% if is_granted('ROLE_USER') %} {# Vérifie si l'utilisateur est authentifié #}
                <button class="btn"><a href="{{ path('app_comment_new', {'id': produit.id}) }}">Ajouter un avis</a></button>
            {% endif %}
        {% endif %}


{% endblock %}


